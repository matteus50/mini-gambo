<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<title>GameForge AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  color: white;
}
header {
  background: rgba(0,0,0,0.6);
  padding: 15px;
  text-align: center;
  font-size: 22px;
  font-weight: bold;
}
.container {
  padding: 20px;
  max-width: 900px;
  margin: auto;
}
.card {
  background: rgba(0,0,0,0.6);
  padding: 20px;
  border-radius: 16px;
  margin-bottom: 20px;
}
input, textarea, select, button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 10px;
  border: none;
  font-size: 16px;
}
button {
  background: #00ff88;
  cursor: pointer;
  font-weight: bold;
}
.hidden { display: none; }
canvas {
  background: #000;
  border-radius: 10px;
  margin-top: 10px;
}
</style>
</head>

<body>

<header>ðŸŽ® GameForge AI</header>

<div class="container">

  <!-- LOGIN -->
  <div id="login" class="card">
    <h2>Entrar / Criar Conta</h2>
    <input id="email" placeholder="Email" type="email">
    <input id="senha" placeholder="Senha" type="password">
    <button onclick="entrar()">Entrar</button>
    <button onclick="criarConta()">Criar Conta</button>
    <p id="msgLogin" style="color:#ff4444;"></p>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard" class="hidden">

    <div class="card">
      <h2>Bem-vindo, <span id="userLabel"></span> ðŸ‘‹</h2>
      <button onclick="logout()">Sair</button>
    </div>

    <div class="card">
      <h3>Criar novo jogo</h3>
      <textarea id="prompt" placeholder="Ex: jogo de nave desviando de meteoros..."></textarea>
      <select id="tipo">
        <option value="runner">Desviar de obstÃ¡culos</option>
        <option value="clicker">Clique rÃ¡pido</option>
        <option value="dodge">SobrevivÃªncia</option>
      </select>
      <button onclick="criarJogo()">Gerar jogo</button>
    </div>

    <div class="card">
      <h3>Seus jogos</h3>
      <ul id="lista"></ul>
    </div>

    <div class="card hidden" id="areaJogo">
      <h3 id="tituloJogo"></h3>
      <canvas id="game" width="600" height="300"></canvas>
    </div>

  </div>

</div>

<!-- Firebase Script -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDrd4yEzizgRl-ZTkv7Xlz8q2ybkYq-qpY",
  authDomain: "gameforge-ece95.firebaseapp.com",
  projectId: "gameforge-ece95",
  storageBucket: "gameforge-ece95.firebasestorage.app",
  messagingSenderId: "710745276392",
  appId: "1:710745276392:web:3f72e6e1c35b71b0a26e5d"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Login / Logout
function criarConta(){
  const email = document.getElementById("email").value;
  const senha = document.getElementById("senha").value;
  createUserWithEmailAndPassword(auth, email, senha)
    .then((userCredential)=>{ entrar(userCredential.user); })
    .catch((error)=>{ document.getElementById("msgLogin").innerText = error.message; });
}

function entrar(user=null){
  if(!user){
    const email = document.getElementById("email").value;
    const senha = document.getElementById("senha").value;
    signInWithEmailAndPassword(auth, email, senha)
      .catch((error)=>{ document.getElementById("msgLogin").innerText = error.message; });
  }
}

function logout(){ signOut(auth); }

onAuthStateChanged(auth, user=>{
  if(user){
    document.getElementById("login").classList.add("hidden");
    document.getElementById("dashboard").classList.remove("hidden");
    document.getElementById("userLabel").innerText = user.email;
    carregarJogos(user.uid);
  } else {
    document.getElementById("login").classList.remove("hidden");
    document.getElementById("dashboard").classList.add("hidden");
  }
});

// Firestore - Jogos
async function criarJogo(){
  const user = auth.currentUser;
  const prompt = document.getElementById("prompt").value;
  const tipo = document.getElementById("tipo").value;
  if(!prompt) return alert("Digite algo para criar o jogo");
  await addDoc(collection(db, "jogos"), { uid: user.uid, prompt, tipo });
  carregarJogos(user.uid);
}

async function carregarJogos(uid){
  const ul = document.getElementById("lista");
  ul.innerHTML = "";
  const q = query(collection(db,"jogos"), where("uid","==",uid));
  const querySnapshot = await getDocs(q);
  querySnapshot.forEach(doc=>{
    const j = doc.data();
    const li = document.createElement("li");
    li.innerHTML = `<button onclick="abrirJogo('${j.prompt}','${j.tipo}')">ðŸŽ® ${j.prompt}</button>`;
    ul.appendChild(li);
  });
}

// Jogos no canvas
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function abrirJogo(prompt,tipo){
  document.getElementById("areaJogo").classList.remove("hidden");
  document.getElementById("tituloJogo").innerText = prompt;
  if(tipo==="runner") iniciarRunner();
  if(tipo==="clicker") iniciarClicker();
  if(tipo==="dodge") iniciarDodge();
}

// Runner
function iniciarRunner(){
  let x = 50, y = 150, score = 0;
  let obs = [];
  function loop(){
    ctx.clearRect(0,0,600,300);
    ctx.fillStyle="white"; ctx.fillRect(x,y,20,20);
    if(Math.random()<0.03) obs.push({x:600,y:Math.random()*280});
    ctx.fillStyle="red";
    obs.forEach(o=>{
      o.x-=3; ctx.fillRect(o.x,o.y,20,20);
      if(o.x<x+20 && o.y<y+20 && o.y+20>y) { alert("Game over"); obs=[]; score=0; }
    });
    score++; ctx.fillText("Score: "+score,10,20);
    requestAnimationFrame(loop);
  }
  document.onkeydown=e=>{
    if(e.key==="ArrowUp") y-=20;
    if(e.key==="ArrowDown") y+=20;
  };
  loop();
}

// Clicker
function iniciarClicker(){
  let score = 0;
  canvas.onclick = ()=>score++;
  function loop(){
    ctx.clearRect(0,0,600,300);
    ctx.fillText("Clique para ganhar pontos!",200,150);
    ctx.fillText("Score: "+score,10,20);
    requestAnimationFrame(loop);
  }
  loop();
}

// Dodge
function iniciarDodge(){
  let x=300,y=150;
  function loop(){
    ctx.clearRect(0,0,600,300);
    ctx.fillRect(x,y,20,20);
    requestAnimationFrame(loop);
  }
  document.onkeydown=e=>{
    if(e.key==="ArrowUp") y-=10;
    if(e.key==="ArrowDown") y+=10;
    if(e.key==="ArrowLeft") x-=10;
    if(e.key==="ArrowRight") x+=10;
  };
  loop();
}
</script>

</body>
</html>
